{% extends "base.html" %}

{% block title %}Convert to Planning Trip - {{ trip.name }} - HaleWay{% endblock %}

{% block content %}
  <div class="container">
    <div class="breadcrumb">
      <a href="{% url 'trips:trip_list' %}">Trips</a>
      <span>/</span>
      <a href="{% url 'trips:trip_detail' trip.pk %}">{{ trip.name }}</a>
      <span>/</span>
      <span>Convert to Planning</span>
    </div>

    <div class="page-header">
      <h1>Convert Dream Trip to Planning Trip</h1>
      <p class="text-muted">{{ trip.name }} - {{ trip.destination_name }}</p>
    </div>

    <div class="conversion-explainer">
      <h2>Ready to Make It Real?</h2>
      <p>
        Converting this dream trip to a planning trip means you're ready to set specific dates and start organizing the details.
        Once converted, you can add itineraries, packing lists, budgets, and more!
      </p>
    </div>

    <div class="form-container">
      <form method="post" class="form">
        {% csrf_token %}

        <div class="form-section">
          <h2>Trip Dates</h2>
          <p class="section-help">Set the specific dates for your trip.</p>

          <div class="form-row">
            <div class="form-group">
              <label for="{{ form.start_date.id_for_label }}" class="form-label">
                Start Date {% if form.start_date.field.required %}<span class="required">*</span>{% endif %}
              </label>
              {{ form.start_date }}
              {% if form.start_date.errors %}
                <div class="form-error">{{ form.start_date.errors }}</div>
              {% endif %}
            </div>

            <div class="form-group">
              <label for="{{ form.end_date.id_for_label }}" class="form-label">
                End Date {% if form.end_date.field.required %}<span class="required">*</span>{% endif %}
              </label>
              {{ form.end_date }}
              {% if form.end_date.errors %}
                <div class="form-error">{{ form.end_date.errors }}</div>
              {% endif %}
            </div>
          </div>
        </div>

        {% if resort_options %}
          <div class="form-section">
            <h2>Choose Resort (Optional)</h2>
            <p class="section-help">
              Select one of your resort options to become the main resort for this trip. You can skip this and add resort details later.
            </p>

            <div class="form-group">
              <label for="{{ form.chosen_resort_option.id_for_label }}" class="form-label">
                Resort Option
              </label>
              {{ form.chosen_resort_option }}
              {% if form.chosen_resort_option.errors %}
                <div class="form-error">{{ form.chosen_resort_option.errors }}</div>
              {% endif %}
              <small class="form-help">If you've decided on a resort, select it here</small>
            </div>

            <!-- Resort Options Preview -->
            <div class="resort-options-preview">
              <h3>Your Resort Options:</h3>
              <div class="options-list">
                {% for option in resort_options %}
                  <div class="option-preview {% if option.is_preferred %}preferred{% endif %}">
                    <div class="option-header">
                      <strong>{{ option.name }}</strong>
                      {% if option.is_preferred %}
                        <span class="badge badge-sm badge-primary">Preferred</span>
                      {% endif %}
                    </div>
                    {% if option.city or option.state %}
                      <p class="text-muted">{{ option.city }}{% if option.state %}, {{ option.state }}{% endif %}</p>
                    {% endif %}
                    {% if option.estimated_cost_per_night %}
                      <p class="cost">${{ option.estimated_cost_per_night }}/night</p>
                    {% endif %}
                    {% if option.rating %}
                      <p class="rating">
                        {% for i in "12345" %}
                          {% if forloop.counter <= option.rating %}★{% else %}☆{% endif %}
                        {% endfor %}
                      </p>
                    {% endif %}
                  </div>
                {% endfor %}
              </div>
            </div>
          </div>
        {% endif %}

        <div class="conversion-warning">
          <h3>What happens when you convert?</h3>
          <ul>
            <li>Trip status changes from "Dream" to "Planning"</li>
            <li>Specific dates are set (you can change them later)</li>
            <li>If you select a resort, it becomes the main resort (resort options remain for reference)</li>
            <li>You can start adding itinerary items, packing lists, and budget tracking</li>
            <li>Your resort options will still be available for reference</li>
          </ul>
        </div>

        <div class="form-actions">
          <button type="submit" class="btn btn-primary btn-lg">
            Convert to Planning Trip
          </button>
          <a href="{% url 'trips:trip_detail' trip.pk %}" class="btn btn-outline">
            Cancel
          </a>
        </div>
      </form>
    </div>
  </div>

  <style>
    .breadcrumb {
      margin-bottom: var(--spacing-md);
      color: var(--text-secondary);
      font-size: 0.875rem;
    }

    .breadcrumb a {
      color: var(--primary-color);
      text-decoration: none;
    }

    .breadcrumb a:hover {
      text-decoration: underline;
    }

    .breadcrumb span {
      margin: 0 var(--spacing-xs);
    }

    .page-header {
      margin-bottom: var(--spacing-xl);
    }

    .conversion-explainer {
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      color: white;
      padding: var(--spacing-xl);
      border-radius: var(--border-radius);
      margin-bottom: var(--spacing-xl);
      text-align: center;
    }

    .conversion-explainer h2 {
      color: white;
      margin-bottom: var(--spacing-md);
    }

    .conversion-explainer p {
      font-size: 1.125rem;
      opacity: 0.95;
      max-width: 700px;
      margin: 0 auto;
    }

    .form-container {
      max-width: 800px;
      margin: 0 auto;
    }

    .form-section {
      background: var(--bg-primary);
      border: 1px solid var(--border-color);
      border-radius: var(--border-radius);
      padding: var(--spacing-lg);
      margin-bottom: var(--spacing-lg);
    }

    .form-section h2 {
      margin-top: 0;
      margin-bottom: var(--spacing-sm);
      font-size: 1.25rem;
    }

    .section-help {
      color: var(--text-secondary);
      margin-bottom: var(--spacing-md);
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--spacing-md);
    }

    .required {
      color: var(--danger-color);
    }

    @media (max-width: 768px) {
      .form-row {
        grid-template-columns: 1fr;
      }
    }

    .resort-options-preview {
      margin-top: var(--spacing-lg);
      padding-top: var(--spacing-lg);
      border-top: 1px solid var(--border-color);
    }

    .resort-options-preview h3 {
      font-size: 1rem;
      margin-bottom: var(--spacing-md);
      color: var(--text-secondary);
    }

    .options-list {
      display: grid;
      grid-template-columns: 1fr;
      gap: var(--spacing-md);
    }

    @media (min-width: 768px) {
      .options-list {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    .option-preview {
      background-color: var(--gray-50);
      border: 1px solid var(--gray-200);
      border-radius: var(--border-radius);
      padding: var(--spacing-md);
    }

    .option-preview.preferred {
      border-color: var(--primary-color);
      background-color: rgba(46, 134, 171, 0.05);
    }

    .option-header {
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
      margin-bottom: var(--spacing-xs);
    }

    .option-preview p {
      margin: var(--spacing-xs) 0;
      font-size: 0.9375rem;
    }

    .cost {
      color: var(--success-color);
      font-weight: 600;
    }

    .rating {
      color: var(--warning-color);
    }

    .conversion-warning {
      background-color: var(--warning-light);
      border-left: 4px solid var(--warning-color);
      padding: var(--spacing-lg);
      border-radius: var(--border-radius);
      margin-bottom: var(--spacing-xl);
    }

    .conversion-warning h3 {
      margin-top: 0;
      margin-bottom: var(--spacing-md);
      color: var(--warning-dark);
    }

    .conversion-warning ul {
      margin: 0;
      padding-left: var(--spacing-lg);
    }

    .conversion-warning li {
      margin: var(--spacing-sm) 0;
    }

    .form-actions {
      display: flex;
      gap: var(--spacing-md);
      justify-content: center;
      flex-wrap: wrap;
      padding-top: var(--spacing-lg);
    }
  </style>
{% endblock %}
