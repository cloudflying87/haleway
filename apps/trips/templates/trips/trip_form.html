{% extends "base.html" %}

{% block title %}{{ page_title|default:"Create Trip" }} - HaleWay{% endblock %}

{% block content %}
  <div class="container">
    <div class="form-container">
      <h1>{{ page_title|default:"Create Trip" }}</h1>

      <form method="post" class="trip-form">
        {% csrf_token %}

        {% for field in form %}
          <div class="form-group" {% if field.name == 'start_date' or field.name == 'end_date' %}id="date-field-{{ field.name }}"{% endif %}>
            <label for="{{ field.id_for_label }}">
              {{ field.label }}
              {% if field.name == 'start_date' or field.name == 'end_date' %}
                <span class="date-optional-hint" style="display: none; color: var(--text-muted); font-weight: 400;">(optional for dream trips)</span>
              {% endif %}
            </label>
            {{ field }}
            {% if field.help_text %}
              <small class="form-help">{{ field.help_text }}</small>
            {% endif %}
            {% if field.errors %}
              <div class="form-error">{{ field.errors }}</div>
            {% endif %}
          </div>
        {% endfor %}

        <div class="form-actions">
          <button type="submit" class="btn btn-primary">Save Trip</button>
          <a href="{% if family %}{% url 'trips:family_trip_list' family.pk %}{% else %}{% url 'trips:trip_list' %}{% endif %}"
             class="btn btn-outline">Cancel</a>
        </div>
      </form>
    </div>
  </div>

  <style>
    .form-container {
      max-width: 600px;
      margin: 0 auto;
      padding: var(--spacing-xl) 0;
    }

    .trip-form {
      background: var(--bg-primary);
      border: 1px solid var(--border-color);
      border-radius: var(--border-radius);
      padding: var(--spacing-xl);
    }

    .form-group {
      margin-bottom: var(--spacing-lg);
    }

    .form-group label {
      display: block;
      margin-bottom: var(--spacing-sm);
      font-weight: 500;
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
    }

    .form-actions {
      display: flex;
      gap: var(--spacing-md);
      margin-top: var(--spacing-xl);
    }

    .date-field-dimmed {
      opacity: 0.5;
    }
  </style>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const statusField = document.getElementById('id_status');
      const startDateField = document.getElementById('date-field-start_date');
      const endDateField = document.getElementById('date-field-end_date');
      const startDateInput = document.getElementById('id_start_date');
      const endDateInput = document.getElementById('id_end_date');
      const dateHints = document.querySelectorAll('.date-optional-hint');

      function updateDateFields() {
        const isDream = statusField && statusField.value === 'dream';

        if (isDream) {
            // Show optional hint
          dateHints.forEach(hint => hint.style.display = 'inline');
            // Make dates not required
          if (startDateInput) startDateInput.removeAttribute('required');
          if (endDateInput) endDateInput.removeAttribute('required');
            // Dim the date fields visually
          if (startDateField) startDateField.classList.add('date-field-dimmed');
          if (endDateField) endDateField.classList.add('date-field-dimmed');
        } else {
            // Hide optional hint
          dateHints.forEach(hint => hint.style.display = 'none');
            // Make dates required
          if (startDateInput) startDateInput.setAttribute('required', 'required');
          if (endDateInput) endDateInput.setAttribute('required', 'required');
            // Remove dimming
          if (startDateField) startDateField.classList.remove('date-field-dimmed');
          if (endDateField) endDateField.classList.remove('date-field-dimmed');
        }
      }

      if (statusField) {
        // Initial check
        updateDateFields();

        // Listen for changes
        statusField.addEventListener('change', updateDateFields);
      }
    });
  </script>
{% endblock %}
